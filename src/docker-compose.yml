version: '3.8'

services:
  catalogdb:
    image: postgres:16-alpine
    container_name: catalogdb
    environment:
      POSTGRES_DB: CatalogDb
      POSTGRES_USER: ${POSTGRES_USER:-postgres}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-postgres}
    restart: unless-stopped
    volumes:
      - postgres_catalog:/var/lib/postgresql/data
    networks:
      - catalog-network

  catalog.api:
    image: ${DOCKER_REGISTRY:-}catalog.api
    container_name: catalog.api
    build:
      context: .
      dockerfile: Services/Catalog/Catalog.API/Dockerfile
    environment:
      ASPNETCORE_ENVIRONMENT: ${ASPNETCORE_ENVIRONMENT:-Production}
      ConnectionStrings__Database: Host=catalogdb;Port=5432;Database=CatalogDb;Username=${POSTGRES_USER:-postgres};Password=${POSTGRES_PASSWORD:-postgres}
    depends_on:
      - catalogdb
    ports:
      - "${CATALOG_API_PORT:-5000}:8080"
    restart: unless-stopped
    networks:
      - catalog-network

volumes:
  postgres_catalog:
    driver: local

networks:
  catalog-network:
    driver: bridge
